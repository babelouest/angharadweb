<!DOCTYPE html>

<html>
<head>
  <title>Monitor</title>

  <link rel="stylesheet" type="text/css" href="css/jquery.jqplot.min.css" />

  <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="js/jquery.jqplot.min.js"></script>
  <script type="text/javascript" src="js/jqplot.highlighter.min.js"></script>
  <script type="text/javascript" src="js/jqplot.cursor.min.js"></script>
  <script type="text/javascript" src="js/jqplot.canvasTextRenderer.min.js"></script>
  <script type="text/javascript" src="js/jqplot.canvasAxisLabelRenderer.min.js"></script>
  <script type="text/javascript" src="js/jqplot.dateAxisRenderer.min.js"></script>
  
  <script type="text/javascript" src="js/i18next-1.7.4.min.js"></script>
</head>
<body>

<div id="loading"><img src="images/loading.gif" align="absmiddle" /></div>

<script class="code" type="text/javascript">

function getUrlParameter(sParam)
{
  var sPageURL = window.location.search.substring(1);
  var sURLVariables = sPageURL.split('&');
  for (var i = 0; i < sURLVariables.length; i++) 
  {
    var sParameterName = sURLVariables[i].split('=');
    if (sParameterName[0] == sParam) 
    {
      return sParameterName[1];
    }
  }
}
$.i18n.init({fallbackLng:'en'}, function() {
  $(document).ready(function(){

    var prefix = '/angharad';
    var device = getUrlParameter('device');
    var pin = getUrlParameter('pin')?getUrlParameter('pin'):'0';
    var sensor = getUrlParameter('sensor')?getUrlParameter('sensor'):'0';
    var startDate = getUrlParameter('startDate')?getUrlParameter('startDate'):'';
    var url = prefix + '/MONITOR/'+device+'/'+pin+'/'+sensor+'/'+startDate;
    var unit = decodeURIComponent(getUrlParameter('unit'));

    var jqxhr = $.get( url, function(data) {
      var jsonData = $.parseJSON(data);
      var heatPoints = [];
      
      $('#loading').remove();
      $('body').append('<div id="chart" style="height:300px; width:400px;"></div>');
      if (jsonData.values.length > 0) {
        for (var i=0; i<jsonData.values.length; i++){
          var d = new Date(0);
          d.setUTCSeconds(jsonData.values[i].date_time);
          heatPoints.push([d, parseFloat(jsonData.values[i].value)]); 
        }
        var plot3 = $.jqplot('chart', [heatPoints], {
          axes:{
            xaxis:{
              renderer:$.jqplot.DateAxisRenderer,
              tickOptions:{formatString:'%d/%m\n%H:%M'}
            },
            yaxis:{
              tickOptions:{formatString:'%.2f'+unit}
            }
          },
          highlighter:{
            show: true,
            sizeAdjust: 7.5
          },
          cursor:{
            show: false
          },
          series:[{showMarker:false}],
          seriesDefaults: {
            rendererOptions: {
              smooth: true
            }
          },
        });
      } else {
        $('#chart').text($.t('No data monitored'));
      }
    })
    .fail(function() {
      $('#chart').text($.t('Error getting monitor'));
    });
  });
});
</script>

</body>

</html>
